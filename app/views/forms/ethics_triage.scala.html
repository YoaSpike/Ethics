@(triageForm: Form[views.formdata.EthicsTriageForm])

@import foundation._
@import views.foundation.Helpers._
@import helper._
@import partials._

@base("Ethics Triage") {
  <div class="row">
    <div class="large-12 columns">
      <div class="">
        <h4>Does the study include any of the ten following types of research and/or participants?</h4>

        <p>
          @triageForm<br/>
          @triageForm("human_genetics")<br/>
          @triageForm("human_genetics").value<br/>
        </p>

        @helper.form(action=routes.Application.ethics_triage_post()) {
          <div class="panel">
            @checkboxes(
              triageForm,
              Seq[Tuple2[String,String]](
                ("interventions_and_therapies",          "Interventions and therapies, including clinical and non-clinical trials"),
                ("human_genetics",                       "Human genetics"),
                ("pregnant_women_or_fetuses",            "Women who are pregnant and/or the human fetus"),
                ("medically_dependant",                  "People who are highly dependent on medical care who may be unable to give consent"),
                ("cognitively_impaired",                 "People with a cognitive impairment, intellectual disability or a mental illness"),
                ("aboriginal_or_torres_strait_islander", "Research specifically targeting Aboriginal or Torres Strait Islanders"),
                ("illegal_activities",                   "People who may be involved in illegal activities")
              )
            )
          </div>

          <div class="panel" id="justification_panel">
            <label for="justification">You responded "yes" to one of the above queries. If you can, please indicate below why you believe your project qualifies to still be considered a Low or Negligible Risk research project.</label>
            <textarea id="justification" name="justification">@if(triageForm("justification").value) {@triageForm("justification").value}</textarea>
          </div>

          @if(triageForm.hasGlobalErrors) {
            <p class="error">
              @triageForm.globalError.message
            </p>
          }

          <input type="submit" class="button" value="Save" />
        }
      </div>
    </div>

    <!-- two methods by which the textarea is revealed -->
    <!-- server side -->
    <style type="text/css">
      #justification_panel {
        /*
        basically, if we have data to display, and one of the checkboxes within
        that data is checked, we tell the browser to start off with the
        textarea visible
        */
        @if(triageForm.hasErrors) {
          display: inherit;
        } else {
          @if(!triageForm.value.isEmpty && triageForm.get().anyChecked()) {
            display: inherit;
          } else {
            display: none;
          }
        }
      }
    </style>
  </div>
} {

  @* postScript *@
  <!-- and client side -->
  <script type="text/javascript">
    var ethics_triage_form = document.forms[0],
        inputs = ethics_triage_form.querySelectorAll('input[type="checkbox"]'),
        justification_panel = document.getElementById('justification_panel');

    inputs = Array.prototype.slice.call(inputs);

    ethics_triage_form.onchange = function(ev) {
      'use strict';
      var checked = inputs.filter(function(q) { return q.checked; });

      var display = checked.length !== 0 ? "inherit" : "none";
      justification_panel.style.display = display;
    }
  </script>
}
